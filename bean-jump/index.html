<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bean Jump</title>
    
    <meta name="monetag" content="e843e7f5a6594ee646896681634a4208" />

    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
    </style>
</head>
<body>

<script src="https://unpkg.com/kaplay@3001.0.19/dist/kaplay.js"></script>

<script>
    // 1. Initialize Kaplay
    kaplay({
        background: [135, 206, 235], // Sky Blue
    });

    // 2. Load the "Bean" sprite (built-in test character)
    loadBean(); 

    // 3. Define the Game Scene
    scene("game", () => {
        
        // Add Player (Bean)
        const bean = add([
            sprite("bean"),
            pos(80, 40),
            area(), // Hitbox
            body(), // Gravity
        ]);

        // Add Ground
        add([
            rect(width(), 48),
            pos(0, height() - 48),
            outline(4),
            area(),
            body({ isStatic: true }),
            color(127, 200, 100),
        ]);

        // Controls
        onKeyPress("space", () => {
            if (bean.isGrounded()) bean.jump(800);
        });
        
        onTouchStart(() => {
            if (bean.isGrounded()) bean.jump(800);
        });

        // Spawn Trees
        loop(1.5, () => {
            add([
                rect(48, rand(24, 64)),
                area(),
                outline(4),
                pos(width(), height() - 48),
                anchor("botleft"),
                color(255, 180, 255),
                move(LEFT, 480),
                "tree",
            ]);
        });

        // Collision
        bean.onCollide("tree", () => {
            addKaboom(bean.pos);
            shake();
            go("lose", score);
        });

        // Score
        let score = 0;
        const scoreLabel = add([
            text(score),
            pos(24, 24),
        ]);

        onUpdate(() => {
            score++;
            scoreLabel.text = score;
        });
    });

    // 4. Game Over Scene
    scene("lose", (score) => {
        add([
            text("Game Over"),
            pos(center()),
            anchor("center"),
        ]);
        
        add([
            text(score),
            pos(center().x, center().y + 80),
            anchor("center"),
            scale(2),
        ]);

        onKeyPress("space", () => go("game"));
        onTouchStart(() => go("game"));
    });

    // Start
    go("game");
</script>

</body>
</html>
